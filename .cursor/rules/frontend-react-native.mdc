---
description: React Native + Expo 前端开发规范和最佳实践
globs: front-end/**/*.{ts,tsx}
alwaysApply: false
---

# React Native + Expo 前端开发规范

## ⚠️ 重要：界面语言要求

**本项目所有用户界面文本必须使用中文！**

```typescript
// ✅ GOOD - 使用中文
<Text>欢迎回来！</Text>
<Button title="登录" />
Alert.alert('错误', '请填写所有字段')

// ❌ BAD - 不使用英文
<Text>Welcome Back!</Text>
<Button title="Login" />
Alert.alert('Error', 'Please fill in all fields')
```

详细规范请查看 `i18n-chinese.mdc` 规则文件。

---

## 组件设计

### 函数组件和 Hooks

- 始终使用函数组件，不使用类组件
- 使用 TypeScript 定义组件 Props
- 组件文件名使用 kebab-case，组件名使用 PascalCase

```typescript
// ✅ GOOD
interface PetCardProps {
  pet: Pet
  onPress: (petId: string) => void
}

export function PetCard({ pet, onPress }: PetCardProps) {
  return (
    <TouchableOpacity onPress={() => onPress(pet.id)}>
      <Text>{pet.name}</Text>
    </TouchableOpacity>
  )
}

// ❌ BAD - 不使用类组件
class PetCard extends React.Component<PetCardProps> {
  render() {
    return <View>...</View>
  }
}
```

### Props 和状态管理

- 解构 props 而非直接使用 props 对象
- 使用 useState 管理本地状态
- 使用 useMemo 和 useCallback 优化性能

```typescript
// ✅ GOOD
export function PetList({ pets, onRefresh }: PetListProps) {
  const [isRefreshing, setIsRefreshing] = useState(false);

  const handleRefresh = useCallback(async () => {
    setIsRefreshing(true);
    await onRefresh();
    setIsRefreshing(false);
  }, [onRefresh]);

  const sortedPets = useMemo(
    () => pets.sort((a, b) => a.name.localeCompare(b.name)),
    [pets]
  );

  return <FlatList data={sortedPets} refreshing={isRefreshing} />;
}

// ❌ BAD
export function PetList(props: PetListProps) {
  return <FlatList data={props.pets.sort(...)} />;
}
```

## Expo Router 导航

### 文件路由规范

- 使用 Expo Router 的文件系统路由
- 布局文件使用 \_layout.tsx
- 动态路由使用 [id].tsx 格式

```typescript
// ✅ GOOD - app/(tabs)/pets/[id].tsx
import { useLocalSearchParams } from 'expo-router'

export default function PetDetailScreen() {
  const { id } = useLocalSearchParams<{ id: string }>()

  return <PetDetail petId={id} />
}

// ✅ GOOD - 类型安全的导航
import { router } from 'expo-router'

function navigateToPet(petId: string) {
  router.push(`/pets/${petId}`)
}
```

## UI 设计稿参考

### 设计稿位置

- **设计稿路径**: `ui/` 目录存放所有 UI 设计稿
- **引用方式**: 使用 `@ui/文件名` 引用设计稿
- **当前设计稿**: `ui/Screen@4x.jpg` - 主要界面设计

### 开发时参考设计稿

在开发前端组件和页面时，始终参考设计稿来确保：

```typescript
// 在开发时，请参考设计稿实现以下内容：
// 1. 组件布局和间距（padding, margin）
// 2. 颜色和字体样式
// 3. 图标和图片位置
// 4. 交互元素的尺寸和位置
// 5. 响应式布局规则

// ✅ GOOD - 严格按照设计稿实现
const styles = StyleSheet.create({
  container: {
    padding: 16, // 参考设计稿的间距
    borderRadius: 12, // 参考设计稿的圆角
    backgroundColor: '#F5F5F5' // 参考设计稿的颜色
  }
})

// ❌ BAD - 随意设置样式，未参考设计稿
const styles = StyleSheet.create({
  container: {
    padding: 20, // 未参考设计稿
    borderRadius: 8
  }
})
```

### 如何使用设计稿

1. **查看设计稿**: 在对话中使用 `@ui/Screen@4x.jpg` 引用设计稿
2. **提取样式**: 从设计稿中识别颜色值、字体大小、间距等
3. **保持一致**: 确保实现的组件与设计稿完全匹配
4. **细节优化**: 注意阴影、渐变、动画等细节效果

```typescript
// ✅ GOOD - 在实现时明确说明参考了设计稿的哪部分
// 例如: "根据设计稿顶部导航栏设计"
export function NavigationHeader() {
  return (
    <ThemedView style={styles.header}>
      <ThemedText style={styles.title}>PawWisdom</ThemedText>
    </ThemedView>
  )
}

const styles = StyleSheet.create({
  header: {
    height: 56, // 设计稿中导航栏高度
    paddingHorizontal: 16, // 设计稿中左右边距
    backgroundColor: '#FFFFFF'
  },
  title: {
    fontSize: 20, // 设计稿中标题字号
    fontWeight: '600', // 设计稿中字重
    color: '#1A1A1A' // 设计稿中文字颜色
  }
})
```

## 样式设计

### StyleSheet 和主题

- 使用 StyleSheet.create 而非内联样式
- 从 constants/theme 引入颜色和尺寸
- 使用 themed-view 和 themed-text 组件

```typescript
// ✅ GOOD
import { StyleSheet } from 'react-native'
import { Colors } from '@/constants/theme'
import { ThemedView } from '@/components/themed-view'

export function PetCard({ pet }: PetCardProps) {
  return (
    <ThemedView style={styles.container}>
      <ThemedText style={styles.name}>{pet.name}</ThemedText>
    </ThemedView>
  )
}

const styles = StyleSheet.create({
  container: {
    padding: 16,
    borderRadius: 12,
    marginBottom: 12
  },
  name: {
    fontSize: 18,
    fontWeight: '600'
  }
})

// ❌ BAD - 避免内联样式
;<View style={{ padding: 16, borderRadius: 12 }}>
  <Text style={{ fontSize: 18, fontWeight: '600' }}>{pet.name}</Text>
</View>
```

### 响应式设计

- 使用 Dimensions 或 useWindowDimensions 获取屏幕尺寸
- 避免固定宽高，使用 flex 布局
- 考虑 iOS 和 Android 平台差异

```typescript
// ✅ GOOD
import { useWindowDimensions } from 'react-native'

export function ResponsiveGrid() {
  const { width } = useWindowDimensions()
  const numColumns = width > 768 ? 3 : 2

  return <FlatList data={items} numColumns={numColumns} key={numColumns} />
}
```

## 性能优化

### 列表优化

- 使用 FlatList 而非 ScrollView + map
- 实现 keyExtractor 和 getItemLayout
- 使用 React.memo 防止不必要的重渲染

```typescript
// ✅ GOOD
const PetItem = React.memo(({ pet, onPress }: PetItemProps) => (
  <TouchableOpacity onPress={() => onPress(pet.id)}>
    <Text>{pet.name}</Text>
  </TouchableOpacity>
))

export function PetList({ pets }: PetListProps) {
  const renderItem = useCallback(
    ({ item }: { item: Pet }) => <PetItem pet={item} onPress={handlePetPress} />,
    [handlePetPress]
  )

  return (
    <FlatList
      data={pets}
      renderItem={renderItem}
      keyExtractor={(item) => item.id}
      getItemLayout={(data, index) => ({
        length: ITEM_HEIGHT,
        offset: ITEM_HEIGHT * index,
        index
      })}
    />
  )
}

// ❌ BAD
;<ScrollView>
  {pets.map((pet) => (
    <PetItem key={pet.id} pet={pet} />
  ))}
</ScrollView>
```

### 图片优化

- 使用 expo-image 而非 Image
- 提供 placeholder 和 contentFit
- 实现图片缓存策略

```typescript
// ✅ GOOD
import { Image } from 'expo-image';

<Image
  source={{ uri: pet.avatarUrl }}
  placeholder={require('@/assets/images/placeholder.png')}
  contentFit="cover"
  style={styles.avatar}
  cachePolicy="memory-disk"
/>

// ❌ BAD
<Image source={{ uri: pet.avatarUrl }} style={styles.avatar} />
```

## 数据获取

### API 调用

- 使用 useEffect 配合 async 函数
- 实现加载、错误和空状态
- 使用 AbortController 清理请求

```typescript
// ✅ GOOD
export function usePetData(petId: string) {
  const [pet, setPet] = useState<Pet | null>(null)
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState<Error | null>(null)

  useEffect(() => {
    const controller = new AbortController()

    async function fetchPet() {
      try {
        setLoading(true)
        const response = await fetch(`/api/pets/${petId}`, {
          signal: controller.signal
        })
        const data = await response.json()
        setPet(data)
      } catch (err) {
        if (err instanceof Error && err.name !== 'AbortError') {
          setError(err)
        }
      } finally {
        setLoading(false)
      }
    }

    fetchPet()
    return () => controller.abort()
  }, [petId])

  return { pet, loading, error }
}
```

## 用户体验

### 触觉反馈

- 使用 expo-haptics 提供触觉反馈
- 在按钮点击、删除操作时触发

```typescript
// ✅ GOOD
import * as Haptics from 'expo-haptics'

async function handleDelete() {
  await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium)
  // delete logic
}
```

### 加载状态

- 使用 ActivityIndicator 显示加载
- 提供骨架屏或占位符
- 避免长时间空白界面

```typescript
// ✅ GOOD
if (loading) {
  return (
    <ThemedView style={styles.center}>
      <ActivityIndicator size="large" />
    </ThemedView>
  )
}

if (error) {
  return (
    <ThemedView style={styles.center}>
      <ThemedText>加载失败: {error.message}</ThemedText>
      <Button title="重试" onPress={retry} />
    </ThemedView>
  )
}

if (!data) {
  return (
    <ThemedView style={styles.center}>
      <ThemedText>暂无数据</ThemedText>
    </ThemedView>
  )
}

return <DataView data={data} />
```

## TypeScript 规范

### 类型定义

- 为所有组件定义 Props 接口
- 使用类型推断，避免显式 any
- 共享类型定义在 types/ 目录

```typescript
// ✅ GOOD - types/pet.ts
export interface Pet {
  id: string
  name: string
  species: 'cat' | 'dog' | 'other'
  breed?: string
  birthDate: string
  avatarUrl: string
}

export interface PetEmotion {
  emotion: 'happy' | 'curious' | 'sad' | 'angry'
  confidence: number
  description: string
}

// ✅ GOOD - 组件中使用
import type { Pet } from '@/types/pet'

interface PetCardProps {
  pet: Pet
  onPress: (pet: Pet) => void
}
```

## 代码组织

### 文件结构

- 组件文件导出单个主组件
- 相关工具函数放在同文件或 utils/
- 常量定义在 constants/

```typescript
// ✅ GOOD
// components/pet-card.tsx
interface PetCardProps { ... }

function PetCardContent({ ... }) { ... }  // 内部组件

export function PetCard({ pet }: PetCardProps) {  // 主导出
  return <PetCardContent ... />;
}

// ❌ BAD - 避免多个默认导出
export default function Component1() { ... }
export function Component2() { ... }
```

### 导入顺序

- React 相关导入
- 第三方库
- 本地组件和工具
- 类型导入
- 样式

```typescript
// ✅ GOOD
import React, { useState, useEffect } from 'react'
import { View, Text, StyleSheet } from 'react-native'
import { router } from 'expo-router'
import { Image } from 'expo-image'

import { ThemedView } from '@/components/themed-view'
import { usePetData } from '@/hooks/use-pet-data'

import type { Pet } from '@/types/pet'
```
