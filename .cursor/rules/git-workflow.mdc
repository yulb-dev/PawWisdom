---
description: Git åˆ†æ”¯ç®¡ç†å’Œæäº¤è§„èŒƒ
alwaysApply: true
---

# Git å·¥ä½œæµå’Œæäº¤è§„èŒƒ

## åˆ†æ”¯ç®¡ç†ç­–ç•¥

### åˆ†æ”¯ç±»å‹å’Œå‘½å

**ä¸»è¦åˆ†æ”¯**

- `main` - ç”Ÿäº§ç¯å¢ƒåˆ†æ”¯ï¼Œå§‹ç»ˆä¿æŒå¯éƒ¨ç½²çŠ¶æ€
- `develop` - å¼€å‘ä¸»åˆ†æ”¯ï¼ŒåŒ…å«æœ€æ–°çš„å¼€å‘åŠŸèƒ½

**ä¸´æ—¶åˆ†æ”¯**

- `feature/*` - åŠŸèƒ½å¼€å‘åˆ†æ”¯ï¼Œä» develop åˆ›å»º
- `bugfix/*` - Bug ä¿®å¤åˆ†æ”¯ï¼Œä» develop åˆ›å»º
- `hotfix/*` - ç´§æ€¥ä¿®å¤åˆ†æ”¯ï¼Œä» main åˆ›å»º
- `release/*` - å‘å¸ƒå‡†å¤‡åˆ†æ”¯ï¼Œä» develop åˆ›å»º

### åˆ†æ”¯å‘½åè§„èŒƒ

```bash
# âœ… GOOD - æ¸…æ™°æè¿°åˆ†æ”¯ç”¨é€”
feature/pet-emotion-detection
feature/user-authentication
bugfix/fix-image-upload-crash
hotfix/critical-api-error
release/v1.0.0

# âŒ BAD - å‘½åä¸æ¸…æ™°
feature/new-stuff
bugfix/fix
my-branch
```

### åˆ†æ”¯æ“ä½œæµç¨‹

**åŠŸèƒ½å¼€å‘æµç¨‹**

```bash
# 1. ä» develop åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout develop
git pull origin develop
git checkout -b feature/pet-health-check

# 2. å¼€å‘å¹¶æäº¤
git add .
git commit -m "feat(health): æ·»åŠ å® ç‰©å¥åº·æ£€æŸ¥è¡¨å•"

# 3. æ¨é€åˆ°è¿œç¨‹
git push -u origin feature/pet-health-check

# 4. åˆ›å»º Pull Request åˆ° develop
# 5. Code Review é€šè¿‡ååˆå¹¶
# 6. åˆ é™¤åŠŸèƒ½åˆ†æ”¯
git branch -d feature/pet-health-check
git push origin --delete feature/pet-health-check
```

**Hotfix æµç¨‹**

```bash
# 1. ä» main åˆ›å»º hotfix åˆ†æ”¯
git checkout main
git pull origin main
git checkout -b hotfix/fix-login-error

# 2. ä¿®å¤å¹¶æäº¤
git commit -m "fix(auth): ä¿®å¤ç™»å½•ä»¤ç‰ŒéªŒè¯é”™è¯¯"

# 3. åˆå¹¶åˆ° main å’Œ develop
git checkout main
git merge --no-ff hotfix/fix-login-error
git push origin main

git checkout develop
git merge --no-ff hotfix/fix-login-error
git push origin develop

# 4. åˆ é™¤ hotfix åˆ†æ”¯
git branch -d hotfix/fix-login-error
```

## Commit Message è§„èŒƒ

### Conventional Commits æ ¼å¼

```
<type>(<scope>): <subject>

<body>

<footer>
```

### Type ç±»å‹ï¼ˆå¿…å¡«ï¼‰

| Type       | è¯´æ˜                         | ç¤ºä¾‹                                       |
| ---------- | ---------------------------- | ------------------------------------------ |
| `feat`     | æ–°åŠŸèƒ½                       | feat(pet): æ·»åŠ å® ç‰©æƒ…ç»ªåˆ†æåŠŸèƒ½            |
| `fix`      | Bug ä¿®å¤                     | fix(api): ä¿®å¤ç”¨æˆ·æœåŠ¡ç©ºæŒ‡é’ˆå¼‚å¸¸           |
| `docs`     | æ–‡æ¡£æ›´æ–°                     | docs(readme): æ›´æ–°å®‰è£…æŒ‡å—                 |
| `style`    | ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰       | style(component): ä¿®å¤ä»£ç ç¼©è¿›             |
| `refactor` | é‡æ„ï¼ˆä¸æ˜¯æ–°åŠŸèƒ½ä¹Ÿä¸æ˜¯ä¿®å¤ï¼‰ | refactor(auth): ç®€åŒ–ä»¤ç‰ŒéªŒè¯é€»è¾‘           |
| `perf`     | æ€§èƒ½ä¼˜åŒ–                     | perf(image): å®ç°å›¾ç‰‡æ‡’åŠ è½½                |
| `test`     | æµ‹è¯•ç›¸å…³                     | test(user): æ·»åŠ ç”¨æˆ·æœåŠ¡å•å…ƒæµ‹è¯•           |
| `chore`    | æ„å»º/å·¥å…·é“¾å˜åŠ¨              | chore(deps): å‡çº§ NestJS åˆ° v11            |
| `ci`       | CI/CD é…ç½®                   | ci(github): æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•å·¥ä½œæµ           |
| `revert`   | å›æ»š commit                  | revert: å›æ»š "feat(pet): æ·»åŠ æƒ…ç»ªåˆ†æåŠŸèƒ½" |

### Scope èŒƒå›´ï¼ˆå¯é€‰ï¼‰

æ ¹æ®é¡¹ç›®æ¨¡å—å®šä¹‰ï¼Œå»ºè®®ä½¿ç”¨ï¼š

- `pet` - å® ç‰©ç›¸å…³åŠŸèƒ½
- `user` - ç”¨æˆ·ç›¸å…³åŠŸèƒ½
- `auth` - è®¤è¯æˆæƒ
- `community` - ç¤¾åŒºåŠŸèƒ½
- `health` - å¥åº·ç®¡ç†
- `ai` - AI è¯†åˆ«åŠŸèƒ½
- `api` - API æ¥å£
- `ui` - UI ç»„ä»¶
- `db` - æ•°æ®åº“

### Subject ä¸»é¢˜ï¼ˆå¿…å¡«ï¼‰

**é‡è¦ï¼šä¼˜å…ˆä½¿ç”¨ä¸­æ–‡æè¿°ï¼Œè‹±æ–‡äº¦å¯æ¥å—**

```bash
# âœ… GOOD - ç®€æ´ã€åŠ¨è¯å¼€å¤´ã€æ— å¥å·
# ğŸ‘ æ¨èä½¿ç”¨ä¸­æ–‡
feat(pet): æ·»åŠ å® ç‰©æƒ…ç»ªè¯†åˆ«æ¥å£
fix(auth): ä¿®å¤ JWT ä»¤ç‰Œè¿‡æœŸé—®é¢˜
docs(api): æ›´æ–° Swagger æ–‡æ¡£

# âš ï¸ å¯æ¥å— - è‹±æ–‡æè¿°
feat(pet): add emotion detection api
fix(auth): resolve jwt token expiration issue
docs(api): update swagger documentation

# âŒ BAD - ä¸è§„èŒƒ
feat(pet): æ·»åŠ å® ç‰©æƒ…ç»ªè¯†åˆ«æ¥å£ã€‚  # æœ‰å¥å·
fix: ä¿®å¤ bug  # ä¸å¤Ÿå…·ä½“
æ›´æ–°ä»£ç   # ç¼ºå°‘ type å’ŒèŒƒå›´
```

### å®Œæ•´ç¤ºä¾‹

**ç®€å•æäº¤**

```bash
git commit -m "feat(pet): æ·»åŠ å® ç‰©æ¡£æ¡ˆåˆ›å»ºåŠŸèƒ½"
git commit -m "fix(upload): ä¿®å¤å›¾ç‰‡å‹ç¼©é”™è¯¯"
git commit -m "docs(readme): æ·»åŠ å®‰è£…è¯´æ˜"
```

**è¯¦ç»†æäº¤ï¼ˆå¸¦ body å’Œ footerï¼‰**

```bash
git commit -m "feat(ai): å®ç°å® ç‰©æƒ…ç»ªè¯†åˆ«åŠŸèƒ½

- é›†æˆç™¾åº¦ AI API è¿›è¡Œæƒ…ç»ªæ£€æµ‹
- æ·»åŠ ç½®ä¿¡åº¦åˆ†æ•°è®¡ç®—
- åˆ›å»ºæƒ…ç»ªç»“æœå¡ç‰‡ç»„ä»¶

Closes #123"
```

**Breaking Changeï¼ˆç ´åæ€§æ›´æ–°ï¼‰**

```bash
git commit -m "feat(api)!: ä¿®æ”¹ç”¨æˆ·è®¤è¯ç«¯ç‚¹

BREAKING CHANGE: /api/login ç«¯ç‚¹å·²è¢« /api/auth/login æ›¿ä»£ã€‚
æ‰€æœ‰å®¢æˆ·ç«¯å¿…é¡»æ›´æ–°å…¶ API è°ƒç”¨ã€‚

Refs #456"
```

## Pull Request è§„èŒƒ

### PR æ ‡é¢˜æ ¼å¼

ä½¿ç”¨ä¸ commit message ç›¸åŒçš„æ ¼å¼ï¼ˆå¿…é¡»ä½¿ç”¨ä¸­æ–‡ï¼‰ï¼š

```
feat(pet): æ·»åŠ æƒ…ç»ªè¯†åˆ«åŠŸèƒ½
fix(auth): ä¿®å¤ç™»å½•ä»¤ç‰ŒéªŒè¯é—®é¢˜
```

### PR æè¿°æ¨¡æ¿

```markdown
## å˜æ›´ç±»å‹

- [ ] æ–°åŠŸèƒ½ (feature)
- [ ] Bug ä¿®å¤ (bugfix)
- [ ] é‡æ„ (refactor)
- [ ] æ–‡æ¡£æ›´æ–° (docs)
- [ ] å…¶ä»–

## å˜æ›´å†…å®¹

ç®€è¦æè¿°æœ¬æ¬¡ PR çš„ä¸»è¦å˜æ›´å†…å®¹ã€‚

## ç›¸å…³ Issue

Closes #123

## æµ‹è¯•

- [ ] å·²æ·»åŠ å•å…ƒæµ‹è¯•
- [ ] å·²é€šè¿‡ç°æœ‰æµ‹è¯•
- [ ] å·²æ‰‹åŠ¨æµ‹è¯•
- [ ] æ— éœ€æµ‹è¯•

## æˆªå›¾ï¼ˆå¦‚é€‚ç”¨ï¼‰

æ·»åŠ ç›¸å…³æˆªå›¾æˆ– GIFã€‚

## Checklist

- [ ] ä»£ç éµå¾ªé¡¹ç›®è§„èŒƒ
- [ ] å·²æ›´æ–°ç›¸å…³æ–‡æ¡£
- [ ] æ—  linter é”™è¯¯
- [ ] å·² review è‡ªå·±çš„ä»£ç 
```

## åˆå¹¶ç­–ç•¥

### ä½¿ç”¨ Squash and Merge

å¯¹äºåŠŸèƒ½åˆ†æ”¯åˆå¹¶åˆ° developï¼š

```bash
# âœ… GOOD - å°†å¤šä¸ª commit å‹ç¼©ä¸ºä¸€ä¸ª
git merge --squash feature/pet-emotion
git commit -m "feat(pet): æ·»åŠ æƒ…ç»ªè¯†åˆ«åŠŸèƒ½"
```

### ä¿ç•™ Commit å†å²

å¯¹äº release åˆ†æ”¯åˆå¹¶åˆ° mainï¼š

```bash
# âœ… GOOD - ä¿ç•™å®Œæ•´çš„æäº¤å†å²
git merge --no-ff release/v1.0.0
```

## å¸¸è§åœºæ™¯

### ä¿®æ”¹æœ€åä¸€æ¬¡ commit

```bash
# âœ… GOOD - ä¿®æ”¹ commit message
git commit --amend -m "feat(pet): æ·»åŠ æƒ…ç»ªæ£€æµ‹æ¥å£"

# âœ… GOOD - æ·»åŠ é—æ¼çš„æ–‡ä»¶
git add forgotten-file.ts
git commit --amend --no-edit
```

### åˆå¹¶å¤šä¸ª commit

```bash
# âœ… GOOD - ä½¿ç”¨ interactive rebase
git rebase -i HEAD~3

# åœ¨ç¼–è¾‘å™¨ä¸­å°† pick æ”¹ä¸º squash (s)
pick abc123 feat(pet): æ·»åŠ æƒ…ç»ªæœåŠ¡
squash def456 feat(pet): æ·»åŠ æƒ…ç»ªç±»å‹
squash ghi789 feat(pet): æ›´æ–°æƒ…ç»ªæµ‹è¯•
```

### åŒæ­¥è¿œç¨‹åˆ†æ”¯

```bash
# âœ… GOOD - ä¿æŒåˆ†æ”¯æœ€æ–°
git checkout feature/my-feature
git fetch origin
git rebase origin/develop

# å¦‚æœæœ‰å†²çªï¼Œè§£å†³åç»§ç»­
git add .
git rebase --continue
```

### å›æ»šæ“ä½œ

```bash
# âœ… GOOD - å›æ»šåˆ°æŒ‡å®š commitï¼ˆä¿ç•™å†å²ï¼‰
git revert abc123

# âœ… GOOD - é‡ç½®åˆ°æŒ‡å®š commitï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
git reset --hard abc123

# âŒ BAD - ä¸è¦ force push åˆ°å…±äº«åˆ†æ”¯
git push --force origin develop  # é¿å…ï¼
```

## æœ€ä½³å®è·µ

### Commit é¢‘ç‡

- æ¯ä¸ªé€»è¾‘å˜æ›´å•ç‹¬æäº¤
- é¿å…ä¸€æ¬¡æäº¤è¿‡å¤šå˜æ›´
- æäº¤å‰ç¡®ä¿ä»£ç å¯è¿è¡Œ

### ä»£ç å®¡æŸ¥

- æ‰€æœ‰ä»£ç å¿…é¡»é€šè¿‡ PR å®¡æŸ¥åæ‰èƒ½åˆå¹¶
- PR åº”è¯¥å°è€Œä¸“æ³¨ï¼Œæ˜“äºå®¡æŸ¥
- åŠæ—¶å“åº”å®¡æŸ¥æ„è§

### åˆ†æ”¯ç»´æŠ¤

- å®šæœŸåˆ é™¤å·²åˆå¹¶çš„åˆ†æ”¯
- ä¿æŒåˆ†æ”¯ä¸ develop åŒæ­¥
- é¿å…é•¿æœŸå­˜åœ¨çš„åŠŸèƒ½åˆ†æ”¯

### Commit å†…å®¹

```bash
# âœ… GOOD - æ¯ä¸ª commit åº”è¯¥æ˜¯ç‹¬ç«‹çš„åŠŸèƒ½å•å…ƒ
git commit -m "feat(pet): æ·»åŠ å® ç‰©æ¨¡å‹å’Œä»“å‚¨å±‚"
git commit -m "feat(pet): æ·»åŠ å® ç‰©æœåŠ¡åŠ CRUD æ“ä½œ"
git commit -m "feat(pet): æ·»åŠ å® ç‰©æ§åˆ¶å™¨å’Œè·¯ç”±"

# âŒ BAD - ä¸€æ¬¡æäº¤å¤ªå¤šä¸ç›¸å…³çš„å˜æ›´
git commit -m "æ·»åŠ å® ç‰©åŠŸèƒ½ï¼Œä¿®å¤ç”¨æˆ· bugï¼Œæ›´æ–° readme"
```

## Git é…ç½®å»ºè®®

```bash
# è®¾ç½®ç”¨æˆ·ä¿¡æ¯
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"

# é…ç½®é»˜è®¤ç¼–è¾‘å™¨
git config --global core.editor "code --wait"

# è®¾ç½®é»˜è®¤åˆ†æ”¯å
git config --global init.defaultBranch main

# å¯ç”¨é¢œè‰²è¾“å‡º
git config --global color.ui auto

# é…ç½® pull ç­–ç•¥
git config --global pull.rebase true

# é…ç½® commit æ¨¡æ¿ï¼ˆå¯é€‰ï¼‰
git config --global commit.template ~/.gitmessage
```

## Git Hooksï¼ˆæ¨èï¼‰

åœ¨é¡¹ç›®ä¸­æ·»åŠ  Git hooks ä»¥è‡ªåŠ¨åŒ–æ£€æŸ¥ï¼š

**pre-commit** - æäº¤å‰æ£€æŸ¥

```bash
#!/bin/sh
# .git/hooks/pre-commit

# è¿è¡Œ linter
npm run lint

# è¿è¡Œç±»å‹æ£€æŸ¥
npm run type-check
```

**commit-msg** - æ£€æŸ¥ commit message æ ¼å¼

```bash
#!/bin/sh
# .git/hooks/commit-msg

# ä½¿ç”¨ commitlint æ£€æŸ¥æäº¤ä¿¡æ¯æ ¼å¼
npx commitlint --edit $1
```

å®‰è£… commitlintï¼š

```bash
npm install --save-dev @commitlint/cli @commitlint/config-conventional
```

é…ç½® commitlint.config.jsï¼š

```javascript
module.exports = {
  extends: ['@commitlint/config-conventional'],
  rules: {
    'type-enum': [
      2,
      'always',
      [
        'feat',
        'fix',
        'docs',
        'style',
        'refactor',
        'perf',
        'test',
        'chore',
        'ci',
        'revert'
      ]
    ]
  }
}
```
