# 认证系统测试检查清单

本文档提供完整的认证系统测试检查清单，确保所有功能正常运行。

## 测试环境准备

- [ ] 后端服务已启动（`cd back-end && pnpm run start:dev`）
- [ ] 数据库连接正常
- [ ] 前端应用已启动（`cd front-end && pnpm run start`）
- [ ] 环境变量已正确配置

## 1. 邮箱注册与登录测试

### 1.1 邮箱注册流程

- [ ] 访问注册页面
- [ ] 选择"邮箱注册"标签
- [ ] 输入有效邮箱地址（如：test@example.com）
- [ ] 输入符合规则的密码（如：Test1234）
- [ ] 点击"注册"按钮
- [ ] 跳转到验证码页面
- [ ] 验证页面显示脱敏的邮箱地址
- [ ] 输入验证码 `0000`
- [ ] 点击"继续"按钮
- [ ] 自动登录并跳转到个人中心页面
- [ ] 个人中心显示用户信息

### 1.2 邮箱注册验证测试

- [ ] 不填写邮箱时显示错误提示
- [ ] 不填写密码时显示错误提示
- [ ] 邮箱格式错误时显示提示（如：test@）
- [ ] 密码不符合规则时显示提示
  - [ ] 少于 8 位
  - [ ] 缺少大写字母
  - [ ] 缺少小写字母
  - [ ] 缺少数字
- [ ] 重复邮箱注册时显示"邮箱已存在"

### 1.3 邮箱登录流程

- [ ] 访问登录页面
- [ ] 输入注册的邮箱
- [ ] 系统识别为邮箱模式（不显示验证码登录选项）
- [ ] 输入正确密码
- [ ] 点击"登录"按钮
- [ ] 成功登录并跳转到个人中心

### 1.4 邮箱登录验证测试

- [ ] 不填写邮箱时显示错误提示
- [ ] 不填写密码时显示错误提示
- [ ] 邮箱格式错误时显示提示
- [ ] 密码错误时显示"账号或密码错误"
- [ ] 不存在的邮箱登录时显示"账号或密码错误"

## 2. 手机号注册与登录测试

### 2.1 手机号注册流程（注册页面）

- [ ] 访问注册页面
- [ ] 选择"手机号注册"标签
- [ ] 输入有效手机号（如：13800138000）
- [ ] 点击"获取验证码"按钮
- [ ] 验证码发送成功提示显示
- [ ] 倒计时开始（60 秒）
- [ ] 倒计时期间"获取验证码"按钮禁用
- [ ] 输入验证码 `0000`
- [ ] 点击"注册"按钮
- [ ] 自动完成注册并登录
- [ ] 跳转到个人中心页面

### 2.2 手机号登录流程（登录页面 - 验证码方式）

- [ ] 访问登录页面
- [ ] 点击"手机号登录"按钮或直接输入手机号
- [ ] 系统识别为手机号，显示登录方式切换按钮
- [ ] 选择"验证码登录"标签
- [ ] 输入手机号
- [ ] 点击"获取验证码"按钮
- [ ] 输入验证码 `0000`
- [ ] 点击"登录"按钮
- [ ] 登录成功（如果是新号码会自动注册）
- [ ] 跳转到个人中心

### 2.3 手机号登录流程（登录页面 - 密码方式）

- [ ] 访问登录页面
- [ ] 输入已注册的手机号
- [ ] 系统识别为手机号
- [ ] 选择"密码登录"标签
- [ ] 输入密码
- [ ] 点击"登录"按钮
- [ ] 登录成功并跳转

### 2.4 手机号验证测试

- [ ] 不填写手机号时显示错误提示
- [ ] 手机号格式错误时显示提示
  - [ ] 少于 11 位
  - [ ] 多于 11 位
  - [ ] 不以 1 开头
  - [ ] 包含非数字字符
- [ ] 不填写验证码时显示错误提示
- [ ] 验证码错误时显示提示
- [ ] 验证码过期时显示提示（5 分钟后）
- [ ] 60 秒内重复发送显示倒计时

### 2.5 手机号自动注册测试

- [ ] 使用未注册的手机号登录
- [ ] 输入验证码后成功登录
- [ ] 检查数据库确认用户已创建
- [ ] 确认用户信息包含：
  - [ ] 自动生成的爪印号（username）
  - [ ] 自动生成的昵称
  - [ ] 手机号
  - [ ] 自动生成的邮箱（phone_xxx@pawwisdom.local）

## 3. 微信登录测试

### 3.1 微信登录流程（测试模式）

- [ ] 访问登录或注册页面
- [ ] 点击"微信登录"或"微信快速注册"按钮
- [ ] 使用测试模式（模拟 OpenID）
- [ ] 登录成功并跳转到个人中心
- [ ] 首次登录自动创建账号

### 3.2 微信登录流程（真实环境）

- [ ] 配置真实的微信 AppID
- [ ] 点击"微信登录"按钮
- [ ] 检测到微信客户端
- [ ] 拉起微信授权页面
- [ ] 在微信中确认授权
- [ ] 微信回调应用
- [ ] 应用接收授权码
- [ ] 后端使用授权码换取 OpenID
- [ ] 登录或注册成功
- [ ] 跳转到个人中心

### 3.3 微信登录验证测试

- [ ] 未安装微信时显示提示
- [ ] 微信 AppID 未配置时显示提示
- [ ] 授权失败时显示错误信息
- [ ] 授权码无效时显示错误

### 3.4 微信自动注册测试

- [ ] 使用新的微信账号登录
- [ ] 首次登录自动创建用户
- [ ] 检查数据库确认用户已创建
- [ ] 确认用户信息包含：
  - [ ] 自动生成的爪印号
  - [ ] 自动生成的昵称
  - [ ] 微信 OpenID
  - [ ] 自动生成的邮箱（wx_xxx@pawwisdom.local）

## 4. 通用功能测试

### 4.1 Token 管理

- [ ] 登录成功后 Token 存储在 AsyncStorage
- [ ] 应用重启后自动读取 Token
- [ ] Token 有效时自动保持登录状态
- [ ] Token 无效时跳转到登录页面
- [ ] 退出登录时清除 Token

### 4.2 用户信息获取

- [ ] 登录后可以获取用户信息（`GET /api/auth/me`）
- [ ] 返回的用户信息不包含密码
- [ ] 返回的用户信息格式正确

### 4.3 页面导航

- [ ] 未登录时访问受保护页面跳转到登录页
- [ ] 登录后可以访问个人中心
- [ ] 注册页面和登录页面可以相互跳转
- [ ] 返回按钮功能正常

### 4.4 表单交互

- [ ] 输入框聚焦时高亮显示
- [ ] 密码输入框支持显示/隐藏密码
- [ ] 键盘弹出时页面自动调整
- [ ] 提交按钮在处理时显示加载状态
- [ ] 提交按钮在加载时禁用防止重复提交

## 5. 错误处理测试

### 5.1 网络错误

- [ ] 后端服务未启动时显示连接错误
- [ ] 网络超时时显示超时提示
- [ ] API 返回 500 错误时显示友好提示

### 5.2 业务错误

- [ ] 邮箱已存在
- [ ] 手机号已存在
- [ ] 验证码错误
- [ ] 验证码过期
- [ ] 密码错误
- [ ] 账号不存在

### 5.3 前端验证

- [ ] 所有必填字段的验证
- [ ] 邮箱格式验证
- [ ] 手机号格式验证
- [ ] 密码强度验证
- [ ] 验证码格式验证

## 6. 性能测试

- [ ] 页面加载时间 < 1 秒
- [ ] 登录响应时间 < 2 秒
- [ ] 注册响应时间 < 3 秒
- [ ] 验证码发送响应时间 < 1 秒
- [ ] 页面切换动画流畅

## 7. 兼容性测试

### 7.1 iOS 测试

- [ ] iPhone SE（小屏）
- [ ] iPhone 14（标准屏）
- [ ] iPhone 14 Pro（刘海屏）
- [ ] iPhone 14 Pro Max（大屏）
- [ ] 安全区域适配正常
- [ ] 键盘弹出适配正常

### 7.2 Android 测试

- [ ] 小屏设备（< 5 英寸）
- [ ] 标准屏设备（5-6 英寸）
- [ ] 大屏设备（> 6.5 英寸）
- [ ] 不同 Android 版本（9.0+）

## 8. 安全测试

- [ ] 密码在传输前加密
- [ ] Token 安全存储
- [ ] API 请求包含正确的 Headers
- [ ] 敏感信息不在日志中输出
- [ ] SQL 注入防护（后端 TypeORM）
- [ ] XSS 防护

## 9. 数据库测试

### 9.1 用户表

- [ ] 邮箱唯一性约束
- [ ] 手机号唯一性约束
- [ ] 微信 OpenID 唯一性约束
- [ ] 用户名自动生成（8 位数字）
- [ ] 昵称自动生成（用户{N}）
- [ ] 密码正确加密存储
- [ ] 创建时间自动记录
- [ ] 更新时间自动更新

### 9.2 软删除

- [ ] 删除用户时标记为已删除
- [ ] 查询时自动过滤已删除用户
- [ ] 已删除用户不能登录

## 10. 后端 API 测试

使用以下命令测试后端 API：

```bash
# 1. 邮箱注册
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"Test1234"}'

# 2. 邮箱登录
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"identifier":"test@example.com","password":"Test1234"}'

# 3. 发送手机验证码
curl -X POST http://localhost:3000/api/auth/phone/code \
  -H "Content-Type: application/json" \
  -d '{"phone":"13800138000"}'

# 4. 手机号登录
curl -X POST http://localhost:3000/api/auth/phone/login \
  -H "Content-Type: application/json" \
  -d '{"phone":"13800138000","code":"0000"}'

# 5. 微信登录（测试）
curl -X POST http://localhost:3000/api/auth/wechat \
  -H "Content-Type: application/json" \
  -d '{"openId":"wx_test_123"}'

# 6. 获取用户信息
curl -X GET http://localhost:3000/api/auth/me \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## 测试结果记录

### 测试日期：_________

### 测试人员：_________

### 测试环境：
- [ ] 开发环境
- [ ] 测试环境
- [ ] 生产环境

### 测试设备：
- iOS 设备：________________
- Android 设备：________________

### 测试结果：
- 通过项数：______ / ______
- 失败项数：______
- 阻塞问题：______

### 主要问题：

1. 
2. 
3. 

### 改进建议：

1. 
2. 
3. 

## 注意事项

1. **测试环境**：确保使用独立的测试数据库，不要在生产数据库测试
2. **验证码**：测试环境固定为 `0000`，生产环境需配置真实短信服务
3. **微信登录**：需要真实的 AppID 和 AppSecret 才能在生产环境测试
4. **数据清理**：测试完成后清理测试数据
5. **性能基准**：记录各项操作的响应时间作为基准
6. **安全检查**：定期进行安全审计

## 自动化测试

建议使用以下工具实现自动化测试：

- **单元测试**：Jest
- **集成测试**：Supertest（后端）
- **E2E 测试**：Detox（React Native）
- **API 测试**：Postman/Newman

## 持续集成

建议在 CI/CD 流程中集成以下测试：

1. 代码提交时运行单元测试
2. PR 合并前运行集成测试
3. 部署前运行完整的 E2E 测试
4. 定期运行性能测试和安全扫描
